---
title: "Regex"
---

<style>
div.python pre { background-color: #d0f5a9; }
</style>

<style>
div.r pre { background-color: #dfdddf; }
</style>

# Dealing with strings

<div class = "row">
<div class = "col-md-6">
<div class = "python">

```{python , collapse = T}
# Python 
import time
import psutil
import os

time_ = time.ctime(time.time())
time_info = 'Time: '
mem = psutil.virtual_memory().total/1e9
mem_info = '\nRAM (GB): '
cpu = psutil.cpu_count()
cpu_info = '\n# CPU: '
wd = os.getcwd()
wd_info = '\nCurrent working directory: '

infos = time_info+time_+mem_info+str(mem)+cpu_info+str(cpu)+wd_info+wd

print(infos)

```

In R we use cat() to take into account '\n' (new line), Python automatically understand it with print.

</div>
</div>
<div class = "col-md-6">
<div class = "r">

```{r, collapse = TRUE}
# R
library(benchmarkme)
time_ <- Sys.time()
time_info <- 'Time: '
mem <- get_ram()/1e9
mem_info <- '\nRAM (GB): '
cpu <- get_cpu()$no_of_cores
cpu_info <- '\n# CPUs: '
wd = getwd()
wd_info = '\nCurrent working directory: '

infos <- paste0(time_info,time_,
           mem_info,as.character(mem),
           cpu_info,as.character(cpu),
           wd_info,wd)
print(infos) 

cat(infos) 

```

</div>
</div>
</div>


Here is some information on the computer where this document was compiled. 

The working directory is the path to the folder where we are working, If we read or write on a file without specifiying the exact path (only the name of the file), the program will search for this file in the current working directory.

'\', the backslash character is used to specify special character, tabulation, new lines, backslash or quotes and so on. When dealing with path this may be confusing for the machine. We can specify that the string must be read as it is by using 'r' before the quote.  

Here is a list of escape character that can be usefull

 Escape Sequence | Description 
- | -:
 \\t 	| Insert a tab in the text at this point.
 \\b 	| Insert a backspace in the text at this point.
 \\n 	| Insert a newline in the text at this point.
 \\r 	| Insert a carriage return in the text at this point.
 \\f 	| Insert a formfeed in the text at this point.
 \\' 	| Insert a single quote character in the text at this point.
 \\" 	| Insert a double quote character in the text at this point.
 \\\ 	| Insert a backslash character in the text at this point.   

 
<div class = "row">
<div class = "col-md-6">
<div class = "python">


```{python, collapse = T}
# Python 

wd_t = r'C:\Users\mypath\to\myfolder'
wd_t
print(wd_t)
```

- The point of the r'...' notation is for writing raw strings and use different rules for interpreting backslash escape sequences. If we're just getting the value from another variable, there's no need for an r.

- A string in Python is workng as an array, we can easily select pieces of the string with the position of the letters. In R a string is a block that we need to decompose ourself if we want to select a specific letter. The nb of character present in a string will be then the length of the object.
We can modify string in several ways which are listed here : https://www.w3schools.com/python/python_ref_string.asp  
We see here some classical examples 
```{python , collapse = T, error= T}
# Python 

wd_info = 'Current working directory:\n'+os.getcwd()
slc_infos = wd_info[10:20]
len(slc_info)
slc_infos
slc_infos = list(slc_infos)
slc_infos

# immutable
slc_infos[7] = '0'
slc_infos

# count
wd_info.count('s')

# modify the string
wd_info.title()
wd_info.upper()
wd_info.lower()
splt_inf = wd_info.split(': ')
splt_inf
' '.join(splt_inf)

```
- In Python, the % sign lets us produce formatted output. We can also use "{}".format() in order to change automatically values in raw text. Let's rewritte our function.
```{python , collapse = T}
# Python 

def get_infos():
  time_info = 'Time: '+time.ctime(time.time())
  mem_info = '\nRAM (GB): '+str(psutil.virtual_memory().total/1e9)
  cpu_info = '\n# CPUs: '+str(psutil.cpu_count())
  wd_info = '\nCurrent working directory: '+os.getcwd()
  infos = time_info+mem_info+cpu_info+wd_info
  print(infos)


def get_infos_2():
  infos = '''Time: %s 
  RAM (GB): %s
  # CPUs: %s 
  Current working directory: %s'''% (time.ctime(time.time()),
  psutil.virtual_memory().total/1e9,
  psutil.cpu_count(),
  os.getcwd())
  print(infos)
  
def get_infos_3():
  infos = '''Time: {t} 
  RAM (GB): {ram}
  # CPUs: {cpu} 
  Current working directory: {wd}'''.format(t = time.ctime(time.time()),
  ram = psutil.virtual_memory().total/1e9,
  cpu = psutil.cpu_count(),
  wd = os.getcwd())
  print(infos)
  
  

t = time.time()
get_infos()
print(time.time()-t)


t = time.time()
get_infos_2()
print(time.time()-t)

t = time.time()
get_infos_3()
print(time.time()-t)


```
</div>
</div>

<div class = "col-md-6">
<div class = "r">
```{r, collapse = T}
# R 

wd_t = 'C:\\Users\\mypath\\to\\myfolder'
print(wd_t)
cat(wd_t)
```
 - In R they are no way of told R to read literal backslash, we need to double it while writting it. Also we need to split the string before accessing to element of this string.  
The function 'strsplit' is made to work with vector also, it automatically create a list for which each element of this list is the decomposed string.  
That's why we see '[[1]]' after each strsplit function calls. We want to access only the first element because there is only one string in the object submitted to the function.
```{r , collapse = T, error= T}
# R 
library(stringr)
library(tools)

wd_info  <- paste0('Current working directory: ',getwd())
slc_infos <- wd_info[10:20]
slc_infos
slc_infos <- paste(strsplit(wd_info,split = '')[[1]][10:20],collapse = "")

nchar(slc_infos)
slc_infos
slc_infos <- strsplit(slc_infos,split = '')[[1]]
slc_infos

# mutable
slc_infos[7] = '0'

# count
length(which(strspilt(wd_info,split = '')[[1]]=='S'))

# modify the string
toTitleCase(wd_info)
toupper(wd_info)
tolower(wd_info)
```


```{r , collapse = T}
paste0('a :','1','b :','2','c :','3')
paste('a :','1','b :','2','c :','3')

paste0(c('a :','1','b :','2','c :','3')) # do nothing with a vector
paste(c('a :','1','b :','2','c :','3'),collapse = " ") # safer to use this
str_c(c('a :','1','b :','2','c :','3'),collapse = " ")

paste0(c('a :','b :','c :'),c('1','2','3'))
paste(c('a :','b :','c :'),c('1','2','3'))
paste(c('a :','b :','c :'),c('1','2','3'),collapse = ".")

paste0(c('a :','b :','c :'),c('0'))
paste(c('a :','b :','c :'),c('0'),collapse = "~")
str_c(c('a :~','b :~','c :~'),c('0'))

```


- In R the use of % is also possible for formatting strings. We can directly use sprintf to print the formated string but is also possible to store it for later use. Then we can use cat to print the string containing escape character or we can use writeLines as in 'get_info_2'

```{r , collapse = T}

# R
library(doParallel)

get_infos <- function(){
  time_info = paste0('Time: ',Sys.time())
  mem_info = paste0('\nRAM (GB): ',as.character(get_ram()/1e9))
  cpu_info = paste0('\n# CPUs: ',as.character(detectCores()))
  wd_info = paste0('\nCurrent working directory: ',getwd())
  infos = paste0(time_info,mem_info,cpu_info,wd_info)
  cat(infos)
}


get_infos_2<- function(){
  infos = sprintf('Time: %s 
  RAM (GB): %s
  # CPUs: %s 
  Current working directory: %s',
  Sys.time(),
  get_ram()/1e9,
  detectCores(),
  getwd())
  writeLines(infos) # other way of take into account escape character
}

t = Sys.time()
get_infos()
Sys.time()-t

t = Sys.time()
get_infos_2()
Sys.time()-t


```

</div>
</div>
</div>

# Regular Expressions

- Text used in this section is the abstract of 'ImageNet Classification with Deep Convolutional Neural Networks' (Alex Krizhevsky, Ilya Sutskever, and Geoffrey E. Hinton 2012) presented at 'Advances in Neural Information Processing Systems 25' (NIPS 2012)

'<p>We trained a large, deep convolutional neural network to classify the 1.3 million high-resolution images in the LSVRC-2010 ImageNet training set into the 1000 different classes. On the test data, we achieved top-1 and top-5 error rates of 39.7\% and 18.9\% which is considerably better than the previous state-of-the-art results. The neural network, which has 60 million parameters and 500,000 neurons, consists of five convolutional layers, some of which are followed by max-pooling layers, and two globally connected layers with a final 1000-way softmax. To make training faster, we used non-saturating neurons and a very efficient GPU implementation of convolutional nets. To reduce overfitting in the globally connected layers we employed a new regularization method that proved to be very effective.</p>'

- Regex are a way to express how a character sequence should be matched, it is a a very flexible tool. Regular expression are commonly used in text manipulation, usually such patterns are used by string-searching algorithms for "find" or "find and replace" operations on strings, or for input validation. 

- Except for control characters, (+ ? . * ^ $ ( ) [ ] { } | \), all characters match themselves. You can escape a control character by preceding it with a backslash.

<div class = "row">
<div class = "col-md-6">
<div class = "python">

```{python,echo = T,collapse = TRUE}
# Python 
import re

abstract = open("data/imagenet_abstract.txt", "r").read()
 
re.search('deep',abstract)

re.findall('deep',abstract)

re.sub(r'\\','',abstract)


```

</div>
</div>
<div class = "col-md-6">
<div class = "r">

```{r,echo=T,collapse = TRUE}
# R
library(stringr)
library(readr)

abstract <- as.character(read_file('data/imagenet_abstract.txt'))
  
str_locate_all(pattern = 'deep',abstract)

str_replace_all(abstract,'\\\\','')
```

</div>
</div>
</div>

## Character classes

Example|Description
-|-:
[Pp]ython|Match "Python" or "python"
rub[ye]|Match "ruby" or "rube"
[aeiou]|Match any one lowercase vowel
[0-9]|Match any digit; same as [0123456789]
[a-z]|Match any lowercase ASCII letter
[A-Z]|Match any uppercase ASCII letter
[a-zA-Z0-9]|Match any of the above
[^aeiou]|Match anything other than a lowercase vowel
[^0-9]|Match anything other than a digit

<div class = "row">
<div class = "col-md-6">
<div class = "python">

```{python,echo = T,collapse = TRUE}
# Python 
import re

re.findall('top-[15]',abstract)

# you can also create an iterator
re.finditer('[0-9]',abstract)


```

</div>
</div>
<div class = "col-md-6">
<div class = "r">

```{r,echo=T,collapse = TRUE}
# R
library(stringr)

str_match_all(abstract,'top-[15]')

str_locate_all(abstract,'[0-9]')


```

</div>
</div>
</div>

## Special Character Classes

Example|Description
-|-:
.|Match any character except newline
\\d|Match a digit: [0-9]
\\D|Match a nondigit: [^0-9]
\\s|Match a whitespace character: [ \\t\\r\\n\\f]
\\S|Match nonwhitespace: [^ \\t\\r\\n\\f]
\\w|Match a single word character: [A-Za-z0-9_]
\\W|Match a nonword character: [^A-Za-z0-9_]

<div class = "row">
<div class = "col-md-6">
<div class = "python">

```{python,echo = T,collapse = TRUE}
# Python 
import re

re.sub('\w','',abstract)

```

</div>
</div>
<div class = "col-md-6">
<div class = "r">

```{r,echo=T,collapse = TRUE}
# R
library(stringr)

str_replace_all(abstract,'\\w','')
```

</div>
</div>
</div>

##Repetition Cases

Example|Description
-|-:
ruby?|Match "rub" or "ruby": the y is optional
ruby*|Match "rub" plus 0 or more ys
ruby+|Match "rub" plus 1 or more ys
\\d{3}|Match exactly 3 digits
\\d{3,}|Match 3 or more digits
\\d{3,5}|Match 3, 4, or 5 digits

Nongreedy repetition
This matches the smallest number of repetitions

Example|Description
-|-:	
<.*>|Greedy repetition: matches "<python>perl>"
<.*?>|Nongreedy: matches "<python>" in "<python>perl>"

<div class = "row">
<div class = "col-md-6">
<div class = "python">

```{python,echo = T,collapse = TRUE}
# Python 
import re

re.findall('\d{2,4}',abstract)

re.findall('<.*?>',abstract)

```

</div>
</div>
<div class = "col-md-6">
<div class = "r">

```{r,echo=T,collapse = TRUE}
# R
library(stringr)

str_extract_all(abstract,'\\d{2,4}')

str_extract_all('<.*?>',abstract)

```

</div>
</div>
</div>

## Grouping with Parentheses

Example|Description
-|-:
\\D\\d+|No group: + repeats \\d
(\\D\\d)+|Grouped: + repeats \\D\\d pair
([Pp]ython(, )?)+|Match "Python", "Python, python, python", etc.

<div class = "row">
<div class = "col-md-6">
<div class = "python">

```{python,echo = T,collapse = TRUE}
# Python 
import re


```

</div>
</div>
<div class = "col-md-6">
<div class = "r">

```{r,echo=T,collapse = TRUE}
# R
library(stringr)

```

</div>
</div>
</div>

## Backreferences
This matches a previously matched group again

Example|Description
-|-:
([Pp])ython&\\1ails|Match python&pails or Python&Pails
(['"])[^\\1]*\\1|Single or double-quoted string. \\1 matches whatever the 1st group matched. \\2 matches whatever the 2nd group matched, etc.

Alternatives
Sr.No.	Example & Description
	
python|perl|Match "python" or "perl"
rub(y|le))|Match "ruby" or "ruble"
Python(!+|\\?)|"Python" followed by one or more ! or one ?

<div class = "row">
<div class = "col-md-6">
<div class = "python">

```{python,echo = T,collapse = TRUE}
# Python 
import re

```

</div>
</div>
<div class = "col-md-6">
<div class = "r">

```{r,echo=T,collapse = TRUE}
# R
library(stringr)

```

</div>
</div>
</div>

## Anchors
This needs to specify match position.

Example|Description
-|-:
^Python|Match "Python" at the start of a string or internal line
Python$|Match "Python" at the end of a string or line
\\APython|Match "Python" at the start of a string
Python\\Z|Match "Python" at the end of a string
\\bPython\\b|Match "Python" at a word boundary
\\brub\\B|\\B is nonword boundary: match "rub" in "rube" and "ruby" but not alone
Python(?=!)|Match "Python", if followed by an exclamation point.
Python(?!!)|Match "Python", if not followed by an exclamation point.

<div class = "row">
<div class = "col-md-6">
<div class = "python">

```{python,echo = T,collapse = TRUE}
# Python 
import re

```

</div>
</div>
<div class = "col-md-6">
<div class = "r">

```{r,echo=T,collapse = TRUE}
# R
library(stringr)

```

</div>
</div>
</div>

# Exercice

Try to translate this code in R, you can use different website or album if you want. 

<a href="Genius_scrap.html">Example with 'rap genius'</a>

# References used

https://docs.oracle.com/javase/tutorial/java/data/characters.html
https://www.tutorialspoint.com/python/python_reg_expressions.html
https://www.w3schools.com/python/python_ref_string.asp
https://thomas-cokelaer.info/tutorials/python/strings.html
